Training and Serving Workflow
Choose conda env here.

[Local Dev] Install conda environment locally
Call bootstrap/create_env.sh conda_envs/scikit-learn-2022-03 to install scikit-learn-2022-03 conda environment.

[Training - Metaflow on Sagemaker] Specify corresponding image for conda environment in the @in_sagemaker operator:
class SagemakerTestFlow(FlowSpec):
...
    @in_sagemaker(image='364942603424.dkr.ecr.us-east-1.amazonaws.com/nextdoor/adroit/scikit-learn-2022-03:main')
    @step
    def train(self):
...
example


[Training - Sagemaker Legacy] Specify corresponding image for conda environment in config.yaml:
train:
  sagemaker:
    image_name: 364942603424.dkr.ecr.us-east-1.amazonaws.com/nextdoor/adroit/scikit-learn-2022-03:main # Refer to conda_envs/
    instance_type: ml.m5.large
...
example


[Serving] Specify conda environment in flavors.yaml:
example:
  offline_only: true
  in_process_models:
    - name: example_sklearn
      version: f549d299-d1b7-4f25-b380-6919c9fc7161
      config_path: 'example_sklearn/flask_config.yaml'
      conda_env: scikit-learn-2022-03
Creating or Updating Conda Environments
Create or update existing conda_envs/{environment}/env.yml.

Open a PR and add update_lockfiles label to the PR. Github Actions will automatically generate lockfiles for you.
image

image

image


Merge your PR to main. Conda environment docker images will be built on every branch and pushed to our ECR repos with the URI 364942603424.dkr.ecr.us-west-2.amazonaws.com/nextdoor/adroit/{conda_env}:{branch_name}
Note: Only main branch images will be replicated to us-east-1, where we host our training stack.
